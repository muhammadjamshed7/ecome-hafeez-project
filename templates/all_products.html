{% extends 'base.html' %}

{% load custom_filters %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
<link href="/static/additional/style/all_product.css" rel="stylesheet">

    <!-- Breadcrumb Start -->
    <div class="container-fluid">
        <div class="row px-xl-5">
            <div class="col-12">
                <nav class="breadcrumb bg-light mb-30">
                    <a class="breadcrumb-item text-dark" href="{% url 'Home' %">Home</a>
                    <span class="breadcrumb-item active">Product Details</span>
                </nav>
            </div>
        </div>
    </div>
    <!-- Breadcrumb End -->


    <!-- Shop Detail Start -->
    <div class="container-fluid pb-5">
        <div class="row px-xl-5">
            <div class="col-lg-5 mb-30">
                <div id="product-carousel" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner bg-light">
                        <div class="carousel-item active">
                            <img class="w-100 h-100" src="{{products_details.main_image_link}}" alt="Image">
                        </div>
                        <div class="carousel-item">
                            <img class="w-100 h-100" src="{{products_details.sub_image_link_2}}" alt="Image">
                        </div>
                        <div class="carousel-item">
                            <img class="w-100 h-100" src="{{products_details.sub_image_link_3}}" alt="Image">
                        </div>
                        <div class="carousel-item">
                            <img class="w-100 h-100" src="{{products_details.sub_image_link_4}}" alt="Image">
                        </div>
                    </div>
                    <a class="carousel-control-prev" href="#product-carousel" data-slide="prev">
                        <i class="fa fa-2x fa-angle-left text-dark"></i>
                    </a>
                    <a class="carousel-control-next" href="#product-carousel" data-slide="next">
                        <i class="fa fa-2x fa-angle-right text-dark"></i>
                    </a>
                </div>
            </div>

            <div class="col-lg-7 h-auto mb-30">
                <div class="h-100 bg-light p-2">
                    <div class="d-flex align-items-left justify-content-left">
                        <h3>{{products_details.product_name}}</h3>
                    </div>
                
                    <div class="d-flex mb-3">
                        <div class="text-primary mr-2">
                          <small id="star1" class="far fa-star"></small>
                          <small id="star2" class="far fa-star"></small>
                          <small id="star3" class="far fa-star"></small>
                          <small id="star4" class="far fa-star"></small>
                          <small id="star5" class="far fa-star"></small>
                        </div>
                        <small class="pt-1" style="color: black;">(<span id="top-review-count">0</span>)</small>
                    </div>
                   
                    <div class="d-flex align-items-left justify-content-left">
                        <h3 class="font-weight-semi-bold mb-1">Rs. {{products_details.actual_price}}</h3><h6 class="text-danger ml-2 py-1 px-2"><del>Rs. {{products_details.list_price}}</del></h6>
                    </div>
                    <div class="d-flex align-items-left justify-content-left">
                        <h5 class="bg-success py-1 px-2 text-white">{{products_details.percent_off}}% Off</h5>
                    </div>
                    

                    <p class="mb-4">{{products_details.product_short_description}}</p>

                    <form onsubmit="addToCart(event)">
                        <div class="d-flex align-items-center mb-4 pt-2">
                          <div class="input-group quantity mr-3" style="width: 130px;">
                            <div class="input-group-btn">
                              <button class="btn btn-primary btn-minus" type="button">
                                <i class="fa fa-minus"></i>
                              </button>
                            </div>
                            <input type="number" class="form-control bg-secondary border-0 text-center" value="1" name="quantity">
                            <div class="input-group-btn">
                              <button class="btn btn-primary btn-plus" type="button">
                                <i class="fa fa-plus"></i>
                              </button>
                            </div>
                          </div>
                          <div>
                            <button class="btn btn-primary px-3" type="submit" data-bs-toggle="modal" data-bs-target="#OpenModal"><i class="fa fa-shopping-cart mr-1"></i> Add To Cart</button>
                          </div>
                          <input type="hidden" name="image" value="{{products_details.main_image_link}}">
                          <input type="hidden" name="name" value="{{products_details.product_name}}">
                          <input type="hidden" name="price" value="{{products_details.actual_price}}">
                        </div>
                        <div>
                            <a class="btn btn-success px-5" href="{% url 'Cart' %}"><i class="fas fa-shopping-cart mr-1"></i> View Cart</a>
                        </div>
                    </form>

                    <div class="modal fade" id="OpenModal">
                        <div class="modal-dialog modal-sm"> <!-- modal-sm, modal-md, modal-lg, modal-xl,modal-fullscreen -->
                            <div class="modal-content">
                                <div class="modal-body">
                                    Product Added Successfully
                                </div>
                                <div class="modal-footer">
                                    <a class="btn btn-sm btn-success" href="{% url 'Cart' %}">View Cart</a>
                                    <button class="btn btn-sm btn-danger" data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex pt-2 mt-2">
                        <strong class="text-dark mr-2">Share on:</strong>
                        <div class="d-inline-flex">
                            <a class="text-dark px-2" href="">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a class="text-dark px-2" href="">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a class="text-dark px-2" href="">
                                <i class="fab fa-linkedin-in"></i>
                            </a>
                            <a class="text-dark px-2" href="">
                                <i class="fab fa-pinterest"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row px-xl-5">
            <div class="col-lg-8 col-md-6 col-sm">
                <div class="bg-light p-30">
                    <div class="nav nav-tabs mb-4">
                        <a class="nav-item nav-link text-dark active" data-toggle="tab" href="#tab-pane-1">Description</a>
                        <a class="nav-item nav-link text-dark" data-toggle="tab" href="#tab-pane-2">Specifications</a>
                        <a class="nav-item nav-link text-dark" data-toggle="tab" href="#tab-pane-3">Reviews (<span id="review-count">0</span>)</a>
                    </div>
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="tab-pane-1">
                            <h4 class="mb-3">Product Description</h4>
                            <p>{{products_details.product_long_description | safe }}</p>
                        </div>
                        
                        <div class="tab-pane fade" id="tab-pane-2">
                            <h4 class="mb-3">Specification</h4>
                            <p>{{products_details.product_specification | safe }}</p>
                        </div>
                        <div class="tab-pane fade" id="tab-pane-3" style="max-height: 400px; overflow-y: auto;">
                            {% for comment in comments %}
                            <div class="row"> 
                                <div class="col-md-6">
                                    <div class="media mb-4">
                                        <img src="/static/img/user.png" alt="Image" class="img-fluid mr-3 mt-1" style="width: 45px;">
                                        <div class="media-body">
                                            <h6>{{ comment.user.username|slice:":2" }}****<small> - <i>{{ comment.created_at|date:"d M Y" }}</i></small></h6>
                                            
                                            <div class="text-primary mb-2">
                                                {% for _ in "*****" %}
                                                    {% if forloop.counter <= comment.rating %}
                                                        <i class="fas fa-star"></i>
                                                    {% else %}
                                                        <i class="far fa-star"></i>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>

                                            <p>{{ comment.content }}</p>
                                            {% if comment.image %}
                                            <img src="{{ comment.image.url }}" alt="Comment Image" class="img-fluid" width="160" height="100">
                                            {% endif %}
                                            {% if request.user.is_authenticated and request.user == comment.user %}
                                            <form class="delete-comment-form" data-comment-id="{{ comment.id }}">
                                                {% csrf_token %}
                                                <button type="submit" class="btn btn-sm btn-danger mt-2 mx-auto">Delete Comment</button>
                                            </form>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6 col-sm">
                <h4 class="mb-4">Leave a review</h4>
                {% for message in messages %}
                    <span class="badge bg-danger text-white py-2 px-3">{{ message }}</span>
                {% endfor %} 

                <div class="d-flex my-3">
                    <p class="mb-0 mr-2">Your Rating * :</p>
                    <div class="text-primary">
                        <span class="star"><i class="far fa-star"></i></span>
                        <span class="star"><i class="far fa-star"></i></span>
                        <span class="star"><i class="far fa-star"></i></span>
                        <span class="star"><i class="far fa-star"></i></span>
                        <span class="star"><i class="far fa-star"></i></span>
                    </div>
                </div>
                <form method="POST" enctype="multipart/form-data" action="{% if request.path == '/store-products-details/{{products_details.slug_ref}}' %} /store-products-details/{{products_details.slug_ref}} {% elif request.path == '/special-offers-details/{{products_details.slug_ref}}' %} /special-offers-details/{{products_details.slug_ref}} {% elif request.path == '/top-products-details/{{products_details.slug_ref}}' %} /top-products-details/{{products_details.slug_ref}} {% endif %}">
                    {% csrf_token %}
                    <input type="hidden" id="ratingInput" name="rating" value="1">
                    <div class="form-group">
                        <label for="message">Your Review *</label>
                        <textarea id="message" name="content" cols="30" rows="5" class="form-control"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="image">Upload Image</label>
                        <input type="file" name="image" class="form-control-file" id="image">
                    </div>
                    <div class="form-group mb-0">
                        <input type="submit" value="Leave Your Review" class="btn btn-primary px-3">
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- Shop Detail End -->


    <!-- Products Start -->
    <div class="container-fluid py-5">
        <h2 class="section-title position-relative text-uppercase mx-xl-5 mb-4"><span class="bg-secondary pr-3">You May Also Like</span></h2>
        <div class="row px-xl-5">
            <div class="col">
                <div class="owl-carousel related-carousel">
                    {% for p in products %}
                    <div class="product-item bg-light">
                        <a href="/store-products-details/{{p.slug_ref}}">
                            <div class="product-img position-relative overflow-hidden">
                                <img class="img-fluid w-100" src="{{p.main_image_link}}" alt="">
                                <div class="d-flex justify-content-between pt-1 px-1" style="font-size:13px;">
                                    {% if product_data_json %}
                                        {% with p.id|stringformat:"s" as product_id %}
                                            {% with product_data_json|get_product_data:product_id as data %}
                                                <div>Sold: {{ data.user_count }}</div>
                                                <div class="rating-portion">
                                                    <div class="rating-value">{{ data.average_rating }}</div>
                                                    <div class="rating-details">
                                                        <div class="rating-star">&#9733;</div>
                                                    </div>
                                                </div>
                                            {% endwith %}
                                        {% endwith %}
                                    {% else %}
                                        <div>Sold: 0</div>
                                        <div class="rating-portion">
                                            <div class="rating-value">0</div>
                                            <div class="rating-details">
                                                <div class="rating-star">&#9733;</div>
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="text-center" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                <a class="h6 text-decoration-none text-truncate" href="/store-products-details/{{p.slug_ref}}">{{p.product_name}}</a>
                                <div class="d-flex align-items-center justify-content-center mt-2">
                                    <h5>Rs. {{p.actual_price}}</h5><h6 class="text-muted ml-2"><del>Rs. {{p.list_price}}</del></h6>
                                </div>
                                <div class="d-flex align-items-center justify-content-center mt-1">
                                    <a href="/store-products-details/{{p.slug_ref}}" class="px-5 py-1" style="background-color:#F69600; color:#fff;">{{p.percent_off}}% Off</a>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    <!-- Products End -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="/static/additional/js/all_product.js"></script>

{% endblock %}

<!--
<form onsubmit="addToCart(event)">
    <div class="d-flex align-items-center mb-4 pt-2">
      <div>
        <button class="btn btn-primary px-3" type="submit" data-bs-toggle="modal" data-bs-target="#OpenModal"><i class="fa fa-shopping-cart mr-1"></i> Add To Cart</button>
      </div>
      <input type="hidden" name="image" value="{{products_details.main_image_link}}">
      <input type="hidden" name="name" value="{{products_details.product_name}}">
      <input type="hidden" name="price" value="{{products_details.actual_price}}">
    </div>
</form>
-->

<script>
    function redirectToNextPage(url) {
        window.location.href = url;
    }
</script>